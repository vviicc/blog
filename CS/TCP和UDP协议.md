###TCP协议
====
#####TCP特点
*	面向连接：即在发送数据之间要建立连接，数据传输过程中要维护连接，数据发送完毕之后要释放连接；
*	可靠交付：TCP传递的数据无差错、无丢失、无重复、且按序到达；
*	流量控制：让发送方的发送速率不要太快，既要让接收方来得及接收，也不要使网络发生拥塞；
*	拥塞控制：若对网络中某资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏——产生拥塞；
*	全双工通信：TCP通信的每一段都维护着一个发送缓存和接收缓存；
*	面向字节流：TCP协议把上层交付的应用层数据单纯地看成是一系列无结构的字节流；
*	点对点连接：每一条 TCP 连接只能有两个端点，是点对点的，端口是套接字Socket
*	首部字节：最低20个字节

#####TCP提供可靠传输的工作原理
1.	停止等待协议:确认重传机制
	*	A发送分组M1，发送就暂停发送，等待B的确认，B收到M1就向A发送确认，A收到对M1的确认后再发送下一个分组;
	*	若中间的某一个分组丢失或是延迟，则A就会使用超时计时器进行超时重传，每个分组发送时都会保留其副本并且设置超时计时器；
	*	停止等待协议的优点是简单，缺点是信道利用率太低。为此引入了连续ARQ协议和滑动窗口协议。

2.	连续ARQ(自动重传请求)协议
	*	发送方维持的发送窗口中可以连续发送多个分组；
	*	接收方采用累积确认的方式，即确认N则表示N之前的包都已经正确收到；
	*	每成功确认M个分组，发送窗口便“滑动”M个分组；
	*	缺点是不能向发送方反映出接收方已经正确收到的所有分组信息，例如丢失中间的分组。
	
3.	窗口滑动协议
	*	“窗口”对应的是一段可以被发送者发送的字节序列，其连续的范围称之为“窗口”；“滑动”则是指这段“允许发送的范围”是可以随着发送的过程而变化的，方式就是按顺序“滑动”。
	*	TCP协议的两端分别为发送者A和接收者B，由于是全双工协议，因此A和B应该分别维护着一个独立的发送缓冲区和接收缓冲区
	*	发送窗口中相关的有四个概念：已发送并收到确认的数据（不再发送窗口和发送缓冲区之内）、已发送但未收到确认的数据（位于发送窗口之中）、允许发送但尚未发送的数据以及发送窗口外发送缓冲区内暂时不允许发送的数据；
	*	只有当A成功发送了数据，即发送的数据得到了B的确认之后，才会移动滑动窗口离开已发送的数据；同时B则确认连续的数据分组，对于乱序的分组则先接收下来，避免网络重复传递：
	
![滑动窗口协议](http://hi.csdn.net/attachment/201009/3/0_1283524025o2c6.gif)

#####TCP流量控制原理
1.	流量控制（滑动窗口实现）
	*	所谓流量控制，主要是接收方传递信息给发送方，使其不要发送数据太快，是一种端到端的控制；
	*	主要的方式就是返回的ACK中会包含自己的接收窗口的大小，并且利用大小来控制发送方的数据发送；
	*	如果B已经告诉A自己的缓冲区已满，于是A停止发送数据；等待一段时间后，B的缓冲区出现了富余，于是给A发送报文告诉A我的rwnd大小为400，但是这个报文不幸丢失了，于是就出现A等待B的通知||B等待A发送数据的死锁状态。
	*	为了处理这种问题，TCP引入了持续计时器（Persistence timer），当A收到对方的零窗口通知时，就启用该计时器，时间到则发送一个1字节的探测报文，对方会在此时回应自身的接收窗口大小，如果结果仍未0，则重设持续计时器，继续等待。
	
2.	传递效率（Nagle算法）
	*	若发送应用进程要把发送的数据逐个字节地送到TCP的发送缓存，则发送方就把第一个数据字节先发送出去，把后面的字节先缓存起来；
	*	当发送方收到第一个字节的确认后（也得到了网络情况和对方的接收窗口大小），再把缓冲区的剩余字节组成合适大小的报文发送出去；
	*	当到达的数据已达到发送窗口大小的一半或以达到报文段的最大长度时，就立即发送一个报文段；

	
#####TCP拥塞控制原理
网络中的链路容量和交换结点中的缓存和处理机都有着工作的极限，当网络的需求超过它们的工作极限时，就出现了拥塞。拥塞控制就是防止过多的数据注入到网络中，这样可以使网络中的路由器或链路不致过载。常用的方法有：
		
*	慢启动
	1.	发送方维持一个叫做“拥塞窗口”的变量，该变量和接收端口共同决定了发送者的发送窗口；
	2.	当主机开始发送数据时，避免一下子将大量字节注入到网络，造成或者增加拥塞，选择发送一个1字节的试探报文；
	3.	当收到第一个字节的数据的确认后，就发送2个字节的报文；
	4.	若再次收到2个字节的确认，则发送4个字节，依次递增2的指数级；
	5.	最后会达到一个提前预设的“慢开始门限”，比如24，即一次发送了24个分组，此时遵循下面的条件判定：
		*1. cwnd < ssthresh， 继续使用慢开始算法；
		*2. cwnd > ssthresh，停止使用慢开始算法，改用拥塞避免算法；
		*3. cwnd = ssthresh，既可以使用慢开始算法，也可以使用拥塞避免算法；
	6. 所谓拥塞避免算法就是：每经过一个往返时间RTT就把发送方的拥塞窗口+1，即让拥塞窗口缓慢地增大，按照线性规律增长；
	7. 当出现网络拥塞，比如丢包时，将慢开始门限设为原先的一半，然后将cwnd设为1，执行慢开始算法（较低的起点，指数级增长）；
	
*	拥塞避免算法
所谓拥塞避免算法就是：每经过一个往返时间RTT就把发送方的拥塞窗口+1，即让拥塞窗口缓慢地增大，按照线性规律增长；

*	快速重传快速恢复
快重传和快恢复则是为了减少因为拥塞导致的数据包丢失带来的重传时间，从而避免传递无用的数据到网络。
	1.	接收方建立这样的机制，如果一个包丢失，则对后续的包继续发送针对该包的重传请求；
	2. 一旦发送方接收到三个一样的确认，就知道该包之后出现了错误，立刻重传该包；
	3. 此时发送方开始执行“快恢复”算法：
		* 慢开始门限减半；
		* cwnd设为慢开始门限减半后的数值；
		* 执行拥塞避免算法（高起点，线性增长）；

#####TCP协议报文格式
	
![TCP报文](http://my.csdn.net/uploads/201204/10/1334067788_5038.jpg "TCP报文")
		
======
###UDP协议
#####UDP协议特点
1.	UDP是无连接的，即发送数据之前不需要建立连接。
2.	UDP 使用尽最大努力交付，即不保证可靠交付，同时也不使用拥塞控制。
3.	UDP是面向报文的。UDP没有拥塞控制，很适合多媒体通信的要求。
4.	UDP支持一对一、一对多、多对一和多对多的交互通信。
5.	UDP的首部开销小，只有 8个字节。		
	
#####UDP协议报文格式
![UDP报文](http://my.csdn.net/uploads/201204/10/1334069453_5734.png  "UDP报文")   

======
#####参考文章
1.	[http://blog.chinaunix.net/uid-26275986-id-4109209.html](http://blog.chinaunix.net/uid-26275986-id-4109679.html)
2.	[http://blog.chinaunix.net/uid-26275986-id-4109679.html](http://blog.chinaunix.net/uid-26275986-id-4109679.html)




